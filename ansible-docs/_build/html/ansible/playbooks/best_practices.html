

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Best Practices &mdash; Avi Networks Ansible 17.1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Avi Networks Ansible 17.1.0 documentation" href="../../index.html"/>
        <link rel="up" title="Playbooks" href="index.html"/>
        <link rel="next" title="Avi Controller Role" href="../../controller/index.html"/>
        <link rel="prev" title="Blocks" href="blocks.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Avi Networks Ansible
          

          
          </a>

          
            
            
              <div class="version">
                17.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Ansible</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#what-is-ansible">What is Ansible?</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#our-automation">Our Automation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../introduction/index.html">Introduction</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Playbooks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../controller/index.html">Avi Controller Role</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../serviceengine/index.html">Avi SE Role</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docker/index.html">Avi Docker Role</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network_interfaces/index.html">Avi Network Interfaces Role</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules/index.html">Avi Ansible Modules</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Avi Networks Ansible</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Ansible</a> &raquo;</li>
        
          <li><a href="index.html">Playbooks</a> &raquo;</li>
        
      <li>Best Practices</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/ansible/playbooks/best_practices.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="best-practices">
<h1>Best Practices<a class="headerlink" href="#best-practices" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#repository-layout" id="id1">Repository Layout</a><ul>
<li><a class="reference internal" href="#basic" id="id2">Basic</a></li>
<li><a class="reference internal" href="#alternative" id="id3">Alternative</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-dynamic-inventory-when-possible" id="id4">Use Dynamic Inventory when Possible</a></li>
<li><a class="reference internal" href="#how-to-seperate-staging-vs-production" id="id5">How to seperate Staging vs Production</a></li>
<li><a class="reference internal" href="#version-control" id="id6">Version Control</a></li>
<li><a class="reference internal" href="#vault" id="id7">Vault</a></li>
</ul>
</div>
<p>There are a few key things we need to keep in mind when dealing with the deployment of Avi with Ansible.</p>
<ul class="simple">
<li>A change in Ansible role values will result in a change in the Avi deployment. Which will likely result in a controller being taken offline for a bit as it restarts with the new service configuration.</li>
<li>Always, Always verify your values to desired values before execution. Ansible is powerful, it will do what you tell it. Remember: Garbage in, Garbage out.</li>
<li>Automation makes it less likely to make a mistake, but automation also allows you scale the mistake very rapidly. Always test, or have someone else verify your code prior to execution.</li>
</ul>
<div class="section" id="repository-layout">
<h2><a class="toc-backref" href="#id1">Repository Layout</a><a class="headerlink" href="#repository-layout" title="Permalink to this headline">¶</a></h2>
<p>We recommend following the structure described by Ansible here <a class="reference external" href="http://docs.ansible.com/ansible/playbooks_best_practices.html#directory-layout">http://docs.ansible.com/ansible/playbooks_best_practices.html#directory-layout</a></p>
<div class="section" id="basic">
<h3><a class="toc-backref" href="#id2">Basic</a><a class="headerlink" href="#basic" title="Permalink to this headline">¶</a></h3>
<div class="highlight-shell"><div class="highlight"><pre><span></span>production                      <span class="c1"># production inventory file</span>
stage                           <span class="c1"># stage inventory file</span>

group-vars/
  group1                        <span class="c1"># variables assigned to hosts in group1</span>
  group2                        <span class="c1"># variables assigned to hosts in group2</span>
host_vars/
  hostname1                     <span class="c1"># variables assigned to &#39;hostname1&#39;</span>
  hostname2                     <span class="c1"># variables assigned to &#39;hostname2&#39;</span>

library/                        <span class="c1"># custom modules go here</span>

avicontroller.yml               <span class="c1"># playbook that can deploy your controller or</span>
                                <span class="c1"># build your controller</span>

avise.yml                       <span class="c1"># playbook that can prepare your SE servers</span>
                                <span class="c1"># for the Linux Server Cluster Avi deploy</span>

create_vip.yml                  <span class="c1"># playbook that uses modules to create vip</span>
...                             <span class="c1"># if you have too many of these,</span>
                                <span class="c1"># think about combining tasks into roles,</span>
                                <span class="c1"># and providing variables to roles</span>

roles/
  avinetworks.avisdk            <span class="c1"># avisdk role downloaded from Galaxy</span>
  avinetworks.avicontroller     <span class="c1"># avicontroller role downloaded from Galaxy</span>
  avinetworks.docker            <span class="c1"># docker role downloaded from Galaxy</span>
  automation_role/              <span class="c1"># this can be the custom role you create</span>
    tasks/
      main.yml                  <span class="c1"># tasks that are common to your playbooks</span>
    vars/
      main.yml                  <span class="c1"># vars you set for your tasks within the role</span>
    defaults/
      main.yml                  <span class="c1"># default values you that can provide</span>
                                <span class="c1"># defaults to your role tasks</span>
                                <span class="c1"># and can be overriden by playbook</span>
    library/                    <span class="c1"># can also contain custom modules</span>
</pre></div>
</div>
</div>
<div class="section" id="alternative">
<h3><a class="toc-backref" href="#id3">Alternative</a><a class="headerlink" href="#alternative" title="Permalink to this headline">¶</a></h3>
<div class="highlight-shell"><div class="highlight"><pre><span></span>production/
  hosts                         <span class="c1"># production inventory file</span>
  group-vars/
    group1                      <span class="c1"># variables assigned to hosts in group1</span>
    group2                      <span class="c1"># variables assigned to hosts in group2</span>
  host_vars/
    hostname1                   <span class="c1"># variables assigned to &#39;hostname1&#39;</span>
    hostname2                   <span class="c1"># variables assigned to &#39;hostname2&#39;</span>
stage/
  hosts                         <span class="c1"># stage inventory file</span>
  group-vars/
    group1                      <span class="c1"># variables assigned to hosts in group1</span>
    group2                      <span class="c1"># variables assigned to hosts in group2</span>
  host_vars/
    hostname1                   <span class="c1"># variables assigned to &#39;hostname1&#39;</span>
    hostname2                   <span class="c1"># variables assigned to &#39;hostname2&#39;</span>

library/                        <span class="c1"># custom modules go here</span>

avicontroller.yml               <span class="c1"># playbook that can deploy your controller or</span>
                                <span class="c1"># build your controller</span>

avise.yml                       <span class="c1"># playbook that can prepare your SE servers</span>
                                <span class="c1"># for the Linux Server Cluster Avi deploy</span>

create_vip.yml                  <span class="c1"># playbook that uses modules to create vip</span>
...                             <span class="c1"># if you have too many of these,</span>
                                <span class="c1"># think about combining tasks into roles,</span>
                                <span class="c1"># and providing variables to roles</span>

roles/
  avinetworks.avisdk            <span class="c1"># avisdk role downloaded from Galaxy</span>
  avinetworks.avicontroller     <span class="c1"># avicontroller role downloaded from Galaxy</span>
  avinetworks.docker            <span class="c1"># docker role downloaded from Galaxy</span>
  automation_role/              <span class="c1"># this can be the custom role you create</span>
    tasks/
      main.yml                  <span class="c1"># tasks that are common to your playbooks</span>
    vars/
      main.yml                  <span class="c1"># vars you set for your tasks within the role</span>
    defaults/
      main.yml                  <span class="c1"># default values you that can provide</span>
                                <span class="c1"># defaults to your role tasks</span>
                                <span class="c1"># and can be overriden by playbook</span>
    library/                    <span class="c1"># can also contain custom modules</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-dynamic-inventory-when-possible">
<h2><a class="toc-backref" href="#id4">Use Dynamic Inventory when Possible</a><a class="headerlink" href="#use-dynamic-inventory-when-possible" title="Permalink to this headline">¶</a></h2>
<p>If you are deploying Avi in a cloud environment using Ansible, it&#8217;s best to use Dynamic Inventory. Dynamic Inventory allows an inventory script to be executed and based on parameters return specific hosts based on tags or other values. For further information please see: <a class="reference external" href="http://docs.ansible.com/ansible/intro_dynamic_inventory.html">http://docs.ansible.com/ansible/intro_dynamic_inventory.html</a></p>
</div>
<div class="section" id="how-to-seperate-staging-vs-production">
<h2><a class="toc-backref" href="#id5">How to seperate Staging vs Production</a><a class="headerlink" href="#how-to-seperate-staging-vs-production" title="Permalink to this headline">¶</a></h2>
<p>When using a static inventory, you will want to seperate staging vs production. These same practices can be applied to Dynamic Inventory as well. For example, using a AWS Tag &#8220;environment:production&#8221; would group systems in the <cite>ec2_tag_environment_production</cite> group. Our recommendation is to seperate your static hosts between two files for staging and production. This will prevent any possible confusion between what hosts are being executed on prior to running a playbook. An example run would look like</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>ansible-playbook -i production myplaybook.yml
</pre></div>
</div>
<p>Running it this way will ensure that only the production hosts are being executed against.</p>
</div>
<div class="section" id="version-control">
<h2><a class="toc-backref" href="#id6">Version Control</a><a class="headerlink" href="#version-control" title="Permalink to this headline">¶</a></h2>
<p>The use of Version Control software is extremely important. It will help maintain an audit trail, and allow others to verify code changes prior to pulling them into the master or branch used to execute. It&#8217;s extremely important to have someone verify configuration changes. A simple typo can easily unintentionally down a service or cause interruption.</p>
</div>
<div class="section" id="vault">
<h2><a class="toc-backref" href="#id7">Vault</a><a class="headerlink" href="#vault" title="Permalink to this headline">¶</a></h2>
<p>We recommend encrypting anything that includes sensitive information, such as password. Ansible has a feature called Vault, which can by the command <code class="docutils literal"><span class="pre">ansible-vault</span></code>. Best advice is to create a file named <code class="docutils literal"><span class="pre">vars</span></code> and <code class="docutils literal"><span class="pre">vault</span></code>, located in the <code class="docutils literal"><span class="pre">group_vars/</span></code> directory. In the <code class="docutils literal"><span class="pre">vars</span></code> file, define all the possible variables needed, including sensitive ones. Then in the <code class="docutils literal"><span class="pre">vault</span></code> file copy all the sensitive variables over and prefix with <code class="docutils literal"><span class="pre">vault_</span></code>. Then in the <code class="docutils literal"><span class="pre">vars</span></code> file point to the matching <code class="docutils literal"><span class="pre">vault_</span></code> variables. Then using <code class="docutils literal"><span class="pre">ansible-vault</span> <span class="pre">encrypt</span> <span class="pre">vault.yml</span></code> to encrypt your sensitive variables. To decrypt on execution use <code class="docutils literal"><span class="pre">--ask-vault-pass</span></code>. When executing your playbook it will prompt for the decrpytion password.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../controller/index.html" class="btn btn-neutral float-right" title="Avi Controller Role" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="blocks.html" class="btn btn-neutral" title="Blocks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Avi Networks.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'17.1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>